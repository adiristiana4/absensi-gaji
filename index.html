<!DOCTYPE html><html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Absensi Karyawan</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom, #e3f2fd, #ffffff);
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      max-width: 400px;
      width: 100%;
    }
    h2 {
      text-align: center;
      color: #333;
    }
    select, input[type="number"] {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .days-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-bottom: 15px;
    }
    .days-grid button {
      padding: 10px;
      border: none;
      border-radius: 8px;
      background: #cfd8dc;
      cursor: pointer;
      font-weight: bold;
    }
    .days-grid button.active {
      background: #2196f3;
      color: white;
    }
    .summary {
      background: #f1f8e9;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
    }
    .btn {
      background: #1976d2;
      color: white;
      border: none;
      padding: 10px 15px;
      width: 100%;
      border-radius: 5px;
      cursor: pointer;
    }
    #slipGaji {
      display: none;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      width: 300px;
      margin: auto;
      margin-top: 20px;
    }
  </style>
</head>
<body>
<div class="container">
  <h2>Absensi Karyawan</h2>
  <label>Pilih Periode:</label>
  <select id="periodeSelect" onchange="generateTanggal()">
    <option value="1">Periode 1 - (1 s.d 15)</option>
    <option value="2">Periode 2 - (16 s.d Akhir)</option>
  </select>  <div class="days-grid" id="tanggalGrid"></div><label>Damage / Hari (Rp):</label> <input type="number" id="damagePerHari" value="5000" />

  <div class="summary">
    <p>Hari Masuk: <span id="hariMasuk">0</span></p>
    <p>Total Gaji: <span id="totalGaji">Rp 0</span></p>
    <p>Total Potongan: <span id="totalPotongan">Rp 0</span></p>
  </div><button class="btn" onclick="logout()">Logout</button> <button class="btn" style="margin-top:10px;background:#28a745" onclick="cetakSlip()">Download Slip Gaji (.png)</button>

</div><div id="slipGaji">
  <h3 style="text-align:center;">Slip Gaji</h3>
  <p>Nama: <span id="slipNama"></span></p>
  <p>Periode: <span id="slipPeriode"></span></p>
  <p>Hari Masuk: <span id="slipHariMasuk"></span></p>
  <p>Total Gaji: <span id="slipGaji"></span></p>
  <p>Total Potongan: <span id="slipPotongan"></span></p>
</div><script>
const gajiPerHari = 202000;
let selectedTanggal = [];

function updateRingkasan() {
  const damage = parseInt(document.getElementById("damagePerHari").value || 0);
  const hari = selectedTanggal.length;
  document.getElementById("hariMasuk").innerText = hari;
  document.getElementById("totalGaji").innerText = `Rp ${formatRupiah(hari * gajiPerHari)}`;
  document.getElementById("totalPotongan").innerText = `Rp ${formatRupiah(hari * damage)}`;
}

function formatRupiah(angka) {
  return angka.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}

function generateTanggal() {
  const grid = document.getElementById("tanggalGrid");
  grid.innerHTML = "";
  selectedTanggal = [];
  const periode = document.getElementById("periodeSelect").value;
  const now = new Date();
  const tahun = now.getFullYear();
  const bulan = now.getMonth();
  const akhirBulan = new Date(tahun, bulan + 1, 0).getDate();
  let mulai = periode === "1" ? 1 : 16;
  let selesai = periode === "1" ? 15 : akhirBulan;
  for (let i = mulai; i <= selesai; i++) {
    const btn = document.createElement("button");
    btn.textContent = i;
    btn.onclick = function() {
      if (selectedTanggal.includes(i)) {
        selectedTanggal = selectedTanggal.filter(t => t !== i);
        btn.classList.remove("active");
      } else {
        selectedTanggal.push(i);
        btn.classList.add("active");
      }
      updateRingkasan();
    };
    grid.appendChild(btn);
  }
  updateRingkasan();
}

document.addEventListener("DOMContentLoaded", generateTanggal);

function logout() {
  localStorage.removeItem('loginNama');
  location.href = "login.html";
}

function cetakSlip() {
  const nama = localStorage.getItem('loginNama') || 'User';
  const periode = document.getElementById('periodeSelect').options[document.getElementById('periodeSelect').selectedIndex].text;
  const hariMasuk = document.getElementById('hariMasuk').textContent;
  const totalGaji = document.getElementById('totalGaji').textContent;
  const totalPotongan = document.getElementById('totalPotongan').textContent;

  document.getElementById('slipNama').textContent = nama;
  document.getElementById('slipPeriode').textContent = periode;
  document.getElementById('slipHariMasuk').textContent = hariMasuk;
  document.getElementById('slipGaji').textContent = totalGaji;
  document.getElementById('slipPotongan').textContent = totalPotongan;

  const slip = document.getElementById("slipGaji");
  slip.style.display = "block";

  html2canvas(slip).then(canvas => {
    const link = document.createElement('a');
    link.download = 'slip_gaji.png';
    link.href = canvas.toDataURL();
    link.click();
    slip.style.display = "none";
  });
}
</script></body>
  </html>
